var app=angular.module("App",["infinite-scroll","ngSanitize","ngRoute","ng-token-auth","ipCookie"]);app.config(function(t,e){e.html5Mode({enabled:!0})}),app.factory("Filters",["$location",function(t){var e={};return{getFilters:function(){return e},setFilter:function(r,o){e[r]=o,t.search(r,o)},removeFilter:function(r){delete e[r],_.isEmpty(e)?t.url(t.path()):t.search(r,null)},useQuery:function(r){e=r,_.isEmpty(e)?t.url(t.path()):t.search(e)},resetAll:function(){e={},t.url(t.path())}}}]),app.factory("Categories",["$http",function(t){var e=[];return{fetchCategories:function(){t.get("categories.json").success(function(t){e=t})},list:function(){return e}}}]),app.factory("SubCategories",["$http",function(t){var e=[];return{fetchSubCategories:function(){t.get("sub_categories.json").success(function(t){e=t})},list:function(){return e}}}]),app.factory("Products",["$http","Filters","$location",function(t,e,r){var o=r.search();e.useQuery(o);var n=[],s=1,i=!0;return{getProducts:function(){return n},currentPage:function(){return s},currentlySearching:function(){return i},enumeratePage:function(){s+=1},resetProducts:function(){n=[]},resetPage:function(){s=1},addProducts:function(t){n=n.concat(t)},fetchProducts:function(){i=!0,t.get("products.json",{async:!0,params:{page:s.toString(),gender:e.getFilters().gender,category:e.getFilters().category,sub_category:e.getFilters().subCategory,search_string:e.getFilters().searchString}}).success(function(t){n=n.concat(t),scrollActive=!0,i=!1})}}}]),app.controller("UserSessionsController",["$scope",function(t){console.log("Hey from users controller"),t.$on("auth:login-error",function(e,r){t.error=r.errors[0]}),t.$on("auth:login-success",function(){$("#signInModal").foundation("reveal","close")}),t.handleLoginBtnClick=function(){$auth.submitLogin(t.loginForm).then(function(){}).catch(function(){})}}]),app.controller("UserRegistrationsController",["$scope","$auth",function(t,e){t.$on("auth:registration-email-success",function(r,o){$("#signUpModal").foundation("reveal","close"),console.log(o),e.submitLogin({email:t.registrationForm.email,password:t.registrationForm.password})}),t.handleRegBtnClick=function(){e.submitRegistration(t.registrationForm).then(function(){}).catch(function(){})}}]),app.controller("ProductsController",["$http","Filters","Products",function(t,e,r){this.scrollActive=!1;var o=this.scrollActive,n=this;n.products=r,this.filters=e,t.get("products.json",{params:{page:r.currentPage().toString(),gender:this.filters.getFilters().gender,category:this.filters.getFilters().category,sub_category:this.filters.getFilters().subCategory,search_string:this.filters.getFilters().searchString}}).success(function(t){n.products.addProducts(t),o=!0}),this.wishFor=function(e,r){r?t.post("products/"+e.id+"/wish.json",{}).success(function(){alert("wished for!")}):$("#signInModal").foundation("reveal","open")},this.openLink=function(t,e){window.open(t.url,"_blank"),e||$("#signUpModal").foundation("reveal","open")},this.nextPage=function(){o===!0&&(o=!1,r.enumeratePage(),t.get("products.json",{async:!0,params:{page:r.currentPage().toString(),gender:this.filters.getFilters().gender,category:this.filters.getFilters().category,sub_category:e.getFilters().subCategory,search_string:e.getFilters().searchString}}).success(function(t){n.products.addProducts(t),o=!0}))}}]),app.controller("GenderController",["Filters","Products",function(t,e){this.setGender=function(r){"mens"===r?t.setFilter("gender","male"):"womens"===r?t.setFilter("gender","female"):""===r&&t.removeFilter("gender"),e.resetProducts(),e.resetPage(),e.fetchProducts()}}]),app.controller("CategoryController",["Filters","Products","Categories",function(t,e,r){var o=this;o.categories=[],r.fetchCategories(),o.categories=r,this.filters=t,this.setCategory=function(r){""===r?t.removeFilter("category"):t.setFilter("category",parseInt(r)),t.removeFilter("subCategory"),e.resetProducts(),e.resetPage(),e.fetchProducts()}}]),app.controller("SubCategoryController",["Filters","Products","Categories","SubCategories",function(t,e,r,o){var n=this;n.subCategories=[],o.fetchSubCategories(),n.subCategories=o,this.filters=t,this.setSubCat=function(r){""===r?t.removeFilter("subCategory"):t.setFilter("subCategory",parseInt(r)),e.resetProducts(),e.resetPage(),e.fetchProducts()}}]),app.controller("SearchController",["Filters","Products","Categories",function(t,e,r){this.updateSearch=function(r){null!==r&&void 0!==r&&""!==r&&" "!==r&&(t.setFilter("searchString",r),e.resetProducts(),e.resetPage(),e.fetchProducts())},this.findCat=function(e){t.removeFilter("category"),t.removeFilter("subCategory");var o=e.toLowerCase().split(" ");_(o).forEach(function(e){void 0===t.getFilters().category&&_(r.list()).forEach(function(r){void 0===t.getFilters().category&&(r.name===e?t.setFilter("category",parseInt(r.id)):r.name.substring(0,r.name.length-1)===e&&t.setFilter("category",parseInt(r.id)))})})}}]);